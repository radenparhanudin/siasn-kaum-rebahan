<?php
/*   _______________________________________
    |  Dikembangkan oleh - Raden Parhanudin |
    |    Whatsapp: https://6282342788059    |
    |_______________________________________|
*/
 namespace Modules\FormasiMenpan\Http\Controllers; use Illuminate\Database\QueryException; use Illuminate\Http\Request; use Maatwebsite\Excel\Facades\Excel; use Modules\FormasiMenpan\Entities\FmStrukturJabatan; use Modules\FormasiMenpan\Entities\FmStrukturJabatanUsulan; use Modules\FormasiMenpan\Exports\FmStrukturJabatanExport; use Modules\FormasiMenpan\services\FmStrukturJabatanService; use Yajra\DataTables\Facades\DataTables; class FmStrukturJabatanController extends FormasiMenpanController { protected $fmStrukturJabatanService; public function __construct(FmStrukturJabatanService $fmStrukturJabatanService) { $this->fmStrukturJabatanService = $fmStrukturJabatanService; } public function index() { $opds = FmStrukturJabatan::whereLevel(2)->get(); return view("\x66\x6f\x72\x6d\141\163\151\155\145\156\x70\x61\156\72\72\x6f\162\147\141\x6e\x69\163\141\x73\x69\56\163\164\162\165\x6b\x74\165\x72\55\152\x61\142\141\x74\141\x6e\56\x69\156\x64\x65\170", compact("\x6f\x70\144\163")); } public function download_parent(Request $request) { if ($request->ajax()) { goto CsorE; CsorE: $this->fmStrukturJabatanService->tarik_data($request); goto tuAM8; hsCAP: $this->fmStrukturJabatanService->tarik_data($request); goto y_v0N; iFEaM: $request["\x70\141\162\145\x6e\x74\137\x69\144"] = $parent->id; goto hsCAP; tuAM8: $parent = FmStrukturJabatan::whereKode("\x30\x30\61")->first(); goto iFEaM; y_v0N: return $this->sendResponse(true, "\x55\160\x64\x61\164\x65\x20\x64\141\164\x61\40\160\141\162\145\x6e\164\x20\142\145\x72\150\x61\x73\x69\x6c"); goto Et2v4; Et2v4: } } public function download_child(Request $request, $id) { if ($request->ajax()) { try { goto o34oL; j_1zz: $level = $parent->level + 1; goto AsbGA; o34oL: $request["\160\x61\x72\x65\156\164\x5f\x69\x64"] = $id; goto ygsHq; iOtGd: $parent = FmStrukturJabatan::find($id); goto j_1zz; AsbGA: $childs = FmStrukturJabatan::where("\x6b\x6f\144\x65", "\154\151\153\145", $parent->kode . "\x2d\45")->whereLevel($level)->get(); goto QzJ_7; QzJ_7: do { $level++; foreach ($childs as $child) { $request["\160\141\x72\x65\x6e\x74\x5f\x69\x64"] = $child->id; $this->fmStrukturJabatanService->tarik_data($request); } $childs = FmStrukturJabatan::where("\x6b\x6f\144\145", "\x6c\151\153\x65", $parent->kode . "\x2d\45")->whereLevel($level)->get(); } while ($childs->count() > 0); goto BtP2C; ygsHq: $this->fmStrukturJabatanService->tarik_data($request); goto iOtGd; BtP2C: } catch (QueryException $e) { return $this->sendResponse(false, $e->getMessage()); } return $this->sendResponse(true, "\x44\157\x77\x6e\x6c\157\x61\144\x20\x63\x68\151\154\x64\x20\142\145\162\150\x61\x73\x69\154"); } } public function export($id = null) { if (!is_null($id)) { $parent = FmStrukturJabatan::find($id); $fileName = "\x53\x54\122\125\x4b\x54\x55\x52\40\x4a\101\x42\x41\x54\x41\x4e\x20{$parent->nama}\x20\55\x20" . date("\131\155\x64\110\151\163") . "\56\x78\x6c\163\x78"; } else { $fileName = "\123\124\x52\x55\113\124\125\122\x20\x4a\x41\102\x41\124\x41\116\40\55\x20" . date("\131\155\x64\110\x69\x73") . "\56\170\154\x73\170"; } return Excel::download(new FmStrukturJabatanExport($id), $fileName); } public function delete(Request $request, $id) { if ($request->ajax()) { $response = $this->fmStrukturJabatanService->delete($id); if (isset($response["\162\145\163\x75\154\164\163"][0]["\151\156\x64\x65\x6b\x73"]) and $response["\x72\145\x73\165\x6c\x74\x73"][0]["\151\156\x64\145\x6b\x73"] == "\x39\x39\x39\x39\71") { goto GakXN; p3LSQ: return $this->sendResponse(true, "\x48\x61\160\x75\163\40\144\141\164\x61\x20\142\145\162\x68\x61\x73\151\x6c\x2e"); goto NCMTR; GakXN: $struktur = FmStrukturJabatan::find($id); goto be1F9; be1F9: FmStrukturJabatan::where("\153\157\x64\145", "\x6c\x69\x6b\145", $struktur->kode . "\x25")->delete(); goto p3LSQ; NCMTR: } else { return $this->sendResponse(false, "\x48\141\x70\165\163\40\x64\141\x74\141\x20\147\x61\147\141\x6c\x2e\40\x44\141\x74\141\x20\155\141\x73\151\x68\x20\141\153\x74\151\146\40\144\151\x20\x66\157\x72\155\x61\x73\151\x2e\x6d\x65\x6e\x70\x61\x6e\x2e\x67\157\x2e\151\144"); } } } public function datatable(Request $request) { if ($request->ajax()) { goto t5e3m; oYO7y: return DataTables::eloquent($data)->addColumn("\x61\x63\164\151\157\156", function ($data) { return view("\x63\157\x6d\160\157\156\x65\156\x74\x73\56\144\x61\164\141\x74\x61\x62\154\145\163\x2d\141\143\x74\x69\x6f\x6e", ["\x61\143\x74\x69\x6f\156" => ["\x64\157\167\x6e\154\x6f\141\144\55\143\x68\x69\x6c\144" => ["\150\162\x65\146" => route("\x66\155\x2d\x6f\x72\147\x2d\x73\x74\162\x75\153\164\165\162\x2d\152\141\x62\x61\164\141\156\56\x64\157\167\x6e\x6c\x6f\141\144\55\x63\150\x69\154\x64", $data->id), "\163\150\x6f\x77" => $data->level > 1 ? 1 : 0], "\145\170\x70\x6f\x72\164" => ["\150\x72\145\x66" => route("\146\x6d\55\157\x72\x67\55\163\x74\162\x75\x6b\x74\x75\162\55\x6a\141\x62\x61\164\x61\156\x2e\x65\x78\160\x6f\162\x74", $data->id), "\163\150\157\167" => 1], "\165\x73\x75\x6c\x74\x61\155\142\x61\x68\x73\x74\162\165\153\164\x75\x72" => ["\150\x72\145\x66" => route("\x66\155\55\x6f\x72\x67\x2d\163\x74\162\165\x6b\164\x75\162\x2d\x6a\141\142\141\164\x61\156\x2e\x75\x73\x75\154\55\x74\x61\x6d\142\141\x68\55\x73\x74\162\165\153\x74\x75\162", $data->id), "\163\x68\x6f\x77" => 1], "\165\x73\x75\154\150\141\160\x75\x73" => ["\150\162\x65\x66" => route("\x66\x6d\x2d\157\x72\147\55\x73\164\162\x75\x6b\x74\165\x72\x2d\152\x61\142\141\x74\x61\156\56\x75\x73\x75\154\55\150\141\x70\165\x73\55\x73\164\x72\x75\153\x74\165\162", $data->id), "\x73\150\157\167" => $data->level > 1 ? 1 : 0], "\x64\145\154\145\164\x65" => ["\x68\x72\x65\x66" => route("\146\x6d\x2d\x6f\162\147\x2d\x73\164\x72\x75\153\164\x75\162\x2d\152\141\142\141\164\x61\x6e\56\144\145\154\x65\x74\145", $data->id), "\x73\150\157\x77" => $data->level > 1 ? 1 : 0]]]); })->toJson(); goto xxonT; mEks1: if (!empty($request->opd_id)) { $parent = FmStrukturJabatan::find($request->opd_id); $data->where("\153\157\x64\145", "\x6c\151\x6b\145", $parent->kode . "\x25"); } goto oYO7y; t5e3m: $data = FmStrukturJabatan::query(); goto mEks1; xxonT: } } public function usul_tambah_struktur(Request $request, $id) { if ($request->ajax()) { goto qanLA; qanLA: $struktur_jabatan = FmStrukturJabatan::find($id); goto gRW16; vaI_J: if ($usulan > 0) { return $this->sendResponse(false, "\125\163\x75\154\x61\156\40\x6d\x61\x73\x69\150\x20\141\x64\x61\x20\171\x61\x6e\147\40\x62\145\x6c\165\155\x20\x64\151\163\145\x6c\x65\163\x61\151\153\141\x6e"); } goto pdg4y; pdg4y: FmStrukturJabatanUsulan::updateOrCreate(["\x66\x6d\137\163\164\x72\x75\153\x74\x75\162\137\152\x61\142\x61\164\141\156\x5f\151\144" => $struktur_jabatan->id, "\x73\x74\x61\x74\165\163\x5f\165\x73\x75\x6c\x61\156" => "\x54\x61\155\x62\141\150"], ["\x66\155\x5f\163\x74\x72\x75\153\x74\165\162\137\x6a\x61\x62\141\x74\141\156\x5f\151\144" => $struktur_jabatan->id, "\156\x6f\155\x6f\162" => 1, "\x70\141\x72\x65\156\x74\137\x70\157\x73\x69\x73\151\x5f\151\x64" => $struktur_jabatan->parent_posisi_id, "\160\x6f\163\x69\163\151\x5f\x69\x64" => $struktur_jabatan->posisi_id, "\156\x61\x6d\x61\137\152\x61\142\x61\x74\141\156" => $struktur_jabatan->nama, "\153\145\154\141\163" => $struktur_jabatan->kelas, "\141\x62\153" => $struktur_jabatan->abk, "\165\156\151\x74\137\x6b\x65\162\x6a\141\x5f\151\x64" => $struktur_jabatan->unit_kerja_id, "\163\164\141\164\x75\x73\137\x75\163\165\154\x61\156" => "\x54\x61\x6d\x62\141\x68"]); goto F2Nqw; F2Nqw: return $this->sendResponse(true, "\x55\163\x75\x6c\40\x62\x65\x72\x68\141\x73\x69\x6c\x20\144\151\164\141\x6d\142\141\150\153\141\x6e"); goto jxSAk; gRW16: $usulan = FmStrukturJabatanUsulan::count(); goto vaI_J; jxSAk: } } public function usul_hapus_struktur(Request $request, $id) { if ($request->ajax()) { goto ue7Y_; tX4HU: return $this->sendResponse(true, "\x55\163\x75\x6c\x20\x62\x65\x72\150\x61\x73\151\x6c\x20\144\151\x74\x61\155\x62\x61\x68\153\141\x6e"); goto JRkQC; ie0jB: $usulan = FmStrukturJabatanUsulan::count(); goto zimpF; ue7Y_: $struktur_jabatan = FmStrukturJabatan::find($id); goto ie0jB; zimpF: if ($usulan > 0) { return $this->sendResponse(false, "\125\x73\x75\154\x61\156\x20\x6d\141\163\151\150\40\141\x64\x61\40\x79\x61\156\147\40\142\145\x6c\x75\x6d\x20\x64\x69\x73\x65\x6c\145\163\141\151\153\x61\156"); } goto UqNvd; UqNvd: FmStrukturJabatanUsulan::updateOrCreate(["\x66\x6d\x5f\163\164\162\x75\x6b\x74\165\x72\137\x6a\x61\142\x61\164\141\156\x5f\151\x64" => $struktur_jabatan->id, "\163\x74\141\x74\165\163\x5f\165\163\x75\x6c\141\x6e" => "\x48\141\160\x75\x73"], ["\146\155\137\x73\164\162\x75\153\164\x75\x72\137\152\141\x62\x61\x74\x61\156\137\151\144" => $struktur_jabatan->id, "\156\x6f\x6d\157\x72" => 1, "\160\141\x72\145\x6e\x74\x5f\x70\157\163\151\163\x69\x5f\x69\144" => $struktur_jabatan->parent_posisi_id, "\x70\157\x73\151\163\x69\x5f\151\x64" => $struktur_jabatan->posisi_id, "\156\x61\x6d\141\x5f\x6a\141\142\x61\164\141\156" => $struktur_jabatan->nama, "\153\145\154\141\163" => $struktur_jabatan->kelas, "\141\x62\153" => $struktur_jabatan->abk, "\165\x6e\x69\164\137\x6b\x65\162\x6a\141\x5f\151\x64" => $struktur_jabatan->unit_kerja_id, "\x73\164\141\164\x75\x73\137\x75\163\x75\154\141\x6e" => "\x48\x61\160\x75\163"]); goto tX4HU; JRkQC: } } }
