<?php
/*   _______________________________________
    |  Dikembangkan oleh - Raden Parhanudin |
    |    Whatsapp: https://6282342788059    |
    |_______________________________________|
*/
 namespace Modules\FormasiMenpan\Http\Controllers\Kepegawaian; use Illuminate\Http\Request; use Maatwebsite\Excel\Facades\Excel; use Modules\FormasiMenpan\Entities\FmNip; use Modules\FormasiMenpan\Entities\FmStrukturJabatan; use Modules\FormasiMenpan\Exports\FmNipStrukturJabatanExport; use Modules\FormasiMenpan\Http\Controllers\FormasiMenpanController; use Modules\FormasiMenpan\services\FmNipService; use Yajra\DataTables\Facades\DataTables; class FmNipController extends FormasiMenpanController { protected $fmNipService; public function __construct(FmNipService $fmNipService) { $this->fmNipService = $fmNipService; } public function index() { $opds = FmStrukturJabatan::whereLevel(2)->get(); return view("\x66\157\162\155\141\163\x69\155\145\x6e\x70\141\x6e\72\72\x6b\145\x70\145\x67\141\167\x61\151\141\x6e\x2e\x6e\x69\160\56\151\x6e\144\x65\x78", compact("\x6f\160\144\x73")); } public function download_nip(Request $request, $id) { if ($request->ajax()) { goto jGeRa; jGeRa: $parent = FmStrukturJabatan::find($id); goto wt4Sp; wt4Sp: $strukturs = FmStrukturJabatan::where("\153\x6f\x64\145", "\x6c\x69\153\145", $parent->kode . "\x25")->where("\x72\x69\151\x6c", "\x3e", 0)->get(); goto nUTFX; y7KoL: return $this->sendResponse(true, "\x44\x6f\x77\156\x6c\157\141\x64\40\x64\141\x74\141\x20\x4e\111\x50\40\163\145\154\145\x73\x61\151"); goto aOnh_; G2gPx: foreach ($strukturs as $struktur) { $this->fmNipService->tarik_data($struktur->id); } goto y7KoL; nUTFX: FmNip::whereIn("\x66\155\137\x73\164\162\x75\153\x74\165\162\x5f\x6a\x61\142\141\x74\x61\x6e\137\151\144", $strukturs->pluck("\x69\x64"))->delete(); goto G2gPx; aOnh_: } } public function export($id) { if (!is_null($id)) { $parent = FmStrukturJabatan::find($id); $fileName = "\123\124\x52\x55\x4b\x54\x55\122\x20\116\x49\120\40{$parent->nama}\40\55\x20" . date("\131\x6d\x64\110\x69\163") . "\x2e\170\x6c\163\170"; } else { $fileName = "\x53\124\x52\125\x4b\124\x55\x52\x20\116\111\120\40\x2d\x20" . date("\x59\x6d\x64\x48\x69\x73") . "\x2e\170\154\163\x78"; } return Excel::download(new FmNipStrukturJabatanExport($id), $fileName); } public function datatable(Request $request) { if ($request->ajax()) { goto ajrzz; ajrzz: $data = FmStrukturJabatan::query()->with("\146\155\x5f\x6e\x69\x70\163")->select("\x66\x6d\137\163\164\x72\165\x6b\164\x75\162\137\x6a\x61\x62\x61\x74\141\156\x73\56\x2a"); goto k1AvS; k1AvS: if (!empty($request->opd_id)) { $parent = FmStrukturJabatan::find($request->opd_id); $data->where("\153\157\144\145", "\154\x69\x6b\x65", $parent->kode . "\x25"); } goto nfcCx; nfcCx: return DataTables::eloquent($data)->addColumn("\144\141\164\x61\137\x61\x73\156\x73", function ($data) { return $data->fm_nips->map(function ($fm_nip) { return "{$fm_nip->nip}\x20\x2d\40{$fm_nip->nama}\40\x28{$fm_nip->bup}\x29"; })->implode("\74\142\162\76"); })->addColumn("\141\143\164\x69\157\156", function ($data) { return view("\143\x6f\x6d\x70\x6f\156\x65\156\x74\163\56\x64\x61\x74\x61\164\x61\x62\x6c\x65\163\x2d\x61\x63\164\x69\x6f\156", ["\x61\143\164\x69\157\x6e" => ["\144\157\x77\x6e\x6c\157\x61\144" => ["\x68\x72\x65\146" => route("\146\x6d\55\153\145\160\55\x6e\x69\160\56\144\x6f\x77\x6e\x6c\157\141\x64\x2d\x6e\151\x70", $data->id), "\x73\150\x6f\167" => $data->level > 1 ? 1 : 0, "\164\x65\170\164" => "\104\x6f\167\156\x6c\157\141\144\40\x4e\111\120"], "\145\x78\x70\x6f\x72\x74" => ["\150\162\145\146" => route("\x66\155\55\153\x65\160\55\156\x69\160\x2e\145\170\x70\157\x72\164", $data->id), "\x73\x68\x6f\167" => 1]]]); })->rawColumns(["\x64\x61\164\x61\x5f\141\x73\x6e\163"])->toJson(); goto segtH; segtH: } } }
